import{a as F,o as p,f as g,h as r,t as z,m as L,b as U,k as q,V as H,s as y,ad as W,r as J,ae as K,W as Q,p as X,q as Y,u as n,c as Z,l as E,i as v,F as ee,j as te,v as ne,E as oe,O as se}from"./entry.91aa836d.js";import{a as ae}from"./BlockRenderer.vue.e8c2c0cb.js";import{_ as ce}from"./nuxt-icon.vue.0e32e4d5.js";import{_ as ie}from"./Container.vue.9443ca48.js";import{r as re,u as le}from"./asyncData.9fe0e931.js";import{u as de}from"./composables.70129d01.js";import"./_plugin-vue_export-helper.c27b6911.js";const pe={class:"bg-lightGrey p-2 rounded"},ue={class:"text-sm"},me=F({__name:"Pane",props:{content:null},emits:["refresh"],setup($,{emit:u}){const h=$;return(o,d)=>(p(),g("div",pe,[r("p",ue,z(h.content),1),r("button",{onClick:d[0]||(d[0]=A=>u("refresh")),class:"bg-white shadow px-2 py-1 rounded block mt-4"}," Refresh")]))}}),_e={class:"mt-24"},ve={key:0},ge={key:1},fe={class:""},ke={class:""},he=["onMouseenter"],Ce={class:"absolute w-full flex justify-between pointer-events-none z-10"},be={class:"flex items-center pointer-events-auto"},we=["onClick"],xe=["onClick"],ye={class:"flex items-center bg-red pointer-events-auto"},$e=["onClick"],Ne=F({__name:"[...slug]",async setup($){let u,h;const{pb:o}=L(),d=U(),A=q(),w=H(),{moveDown:V,moveUp:M,setPage:S,savePage:x}=w,{page:m}=y(w);y(d);const{viewports:Ae,componentId:N}=y(A);let C=W().params.slug;C=C||"index";const _=J({storePending:!0,currentContainer:null}),{pending:Be,data:c}=([u,h]=K(()=>le("pageContent",()=>o.collection("pages").getFirstListItem(`slug="${C}"`,{expand:"containers.block.blocks,containers.component,seo"}))),u=await u,h(),u);_.storePending=!1,de({title:c.value.expand.seo.title?`Eileen George — ${c.value.expand.seo.title}`:`Eileen George — ${c.value.title}`,meta:[{name:"description",content:c.value.expand.seo.description}]}),Q.on("refresh",()=>{console.log("content saved"),_.storePending=!0,b()});const b=async()=>{await setTimeout(async()=>{await re("pageContent"),S(c.value)},400),_.storePending=!1},O=(e,t)=>{M(e,t),x()},R=(e,t)=>{V(e,t),x()},T=async(e,t)=>{const i=await o.collection("containers").getOne(e[t]),s=i.block,a=i.component;s&&await o.collection("blocks").delete(s),a&&await o.collection("components").delete(a),await o.collection("containers").delete(i.id),e.splice(t,1),x()},B=X(()=>d.token?_.currentContainer:null),G=e=>{var i,s;const t=((i=e==null?void 0:e.expand.block)==null?void 0:i.id)||((s=e==null?void 0:e.expand.component)==null?void 0:s.id);return N.value===t},P=async e=>{const t=await o.collection("blocks").create({type:"default",isMaxContainer:!1,cssClasses:[[{paddingTop:"40px"},{marginTop:"40px"}],[],[],[],[]]}),s=(await o.collection("containers").create({block:t.id})).id,a=c.value.containers;a.splice(e,0,s),await o.collection("pages").update(c.value.id,{containers:a}),b()},D=async e=>{const t=await o.collection("components").create({type:"default"}),s=(await o.collection("containers").create({component:t.id})).id,a=c.value.containers;a.splice(e,0,s),await o.collection("pages").update(c.value.id,{containers:a}),b()};return Y(()=>{S(c.value)}),(e,t)=>{var I;const i=me,s=ae,a=ce,j=ie;return p(),g("main",_e,[n(_).storePending?(p(),g("div",ve,"pending")):(p(),g("div",ge,[n(w).debugVisible?(p(),Z(i,{key:0,content:n(m),onRefresh:b},null,8,["content"])):E("",!0),r("div",fe,[r("div",ke,[v(s,{onAddBlock:t[0]||(t[0]=f=>P(0)),onAddComponent:t[1]||(t[1]=f=>D(0)),displayComponentOption:""}),(I=n(m))!=null&&I.expand?(p(!0),g(ee,{key:0},te(n(m).expand.containers,(f,l)=>(p(),g("div",{onMouseenter:k=>n(_).currentContainer=l,key:f.id,class:ne([[{"hover:shadow-edit":n(d).token&&n(B)},{"cursor-cell":n(d).token},{"shadow-edit":G(f)}],"relative"])},[oe(r("div",Ce,[r("div",be,[r("button",{onClick:k=>O(n(m).containers,l),class:"bg-gold"},[v(a,{name:"icon-triangle_up",class:"text-xl"})],8,we),r("button",{onClick:k=>R(n(m).containers,l),class:"bg-gold"},[v(a,{name:"icon-triangle_down",class:"text-xl"})],8,xe)]),r("div",ye,[r("button",{onClick:k=>T(n(m).containers,l)},[v(a,{name:"icon-cross",class:"text-xl"})],8,$e)])],512),[[se,n(B)===l]]),v(j,{container:f,isFirst:l===0},null,8,["container","isFirst"]),v(s,{onAddBlock:k=>P(l+1),onAddComponent:k=>D(l+1),displayComponentOption:""},null,8,["onAddBlock","onAddComponent"])],42,he))),128)):E("",!0)])])]))])}}});export{Ne as default};
