import{_ as M}from"./DYqNPgwz.js";import{f as j,u as E,r as F,o as i,c as l,a as n,A as C,E as V,n as r,d as h,b as x,t as B,B as A,q as O,F as U,x as P,v as R,z as q,g as Z,l as G,k as I}from"./COIFjB77.js";import{v as z}from"./DceLiSyC.js";import{u as J}from"./EqJpNlPG.js";import{d as H}from"./F1WjrixK.js";import{r as T,u as K}from"./Cg1LVvjP.js";const Q={class:"border border-dashed border-darkGrey border-opacity-40 rounded pl-4 p-2 flex items-center justify-between"},W=n("div",{class:""},"Neuen Block erstellen",-1),X={class:"flex items-center gap-4"},ee={class:"flex items-center gap-2"},te=j({__name:"BookingBlockCreator",emits:["createdBlock"],setup(S,{emit:f}){const{pb:y}=E(),_=f,e=F({booking:{start:void 0,end:void 0},deletionConfirmed:!1}),p=a=>{const g=a.split("T")[0],c=a.split("T")[1];return`${g} ${c}:00.123Z`},v=async()=>{const a={bookingType:"block",start:p(e.booking.start),end:p(e.booking.end)};await y.collection("bookings").create(a),e.booking.start=void 0,e.booking.end=void 0,_("createdBlock")};return(a,g)=>{const c=M;return i(),l("div",Q,[W,n("div",X,[n("div",ee,[C(n("input",{type:"datetime-local","onUpdate:modelValue":g[0]||(g[0]=s=>r(e).booking.start=s),class:"border border-grey border-opacity-20 rounded px-4 py-1"},null,512),[[V,r(e).booking.start]]),h(" - "),C(n("input",{type:"datetime-local","onUpdate:modelValue":g[1]||(g[1]=s=>r(e).booking.end=s),class:"border border-grey border-opacity-20 rounded px-4 py-1"},null,512),[[V,r(e).booking.end]])]),n("button",{onClick:v,class:"border-2 border-green hover:border-green/50 text-green hover:text-green/70 rounded px-4 py-1 flex items-center"},[x(c,{name:"icon-trash",class:"text-2xl -ml-2"}),h(" Erstellen ")])])])}}}),oe={class:"border border-grey bg-gradient-to-r from-grey to-offwhite rounded p-4 flex items-center justify-between"},ne=n("div",{class:"text-darkOffwhite"},"Block",-1),re={class:"flex items-center gap-4"},se={class:"flex items-center gap-2"},ie={class:"border border-darkGrey px-2 rounded"},ae={class:"border border-darkGrey px-2 rounded"},de=j({__name:"BookingBlock",props:{booking:{}},emits:["refreshBookings"],setup(S,{emit:f}){const{pb:y}=E(),_=S,e=f,p=c=>new Date(c.split(".")[0]).toLocaleDateString("de-DE",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"}),v=()=>{a.deletionConfirmed=!1},a=F({deletionConfirmed:!1}),g=async()=>{await y.collection("bookings").delete(_.booking.id),a.deletionConfirmed=!1,e("refreshBookings")};return(c,s)=>{const w=M;return i(),l("div",oe,[ne,n("div",re,[n("div",se,[n("span",ie,B(p(c.booking.start)),1),h(" - "),n("span",ae,B(p(c.booking.end)),1)]),C(n("button",{onClick:s[0]||(s[0]=D=>r(a).deletionConfirmed=!0),class:"border-2 border-lightRed hover:border-lightRed/50 text-lightRed hover:text-lightRed/70 rounded px-4 py-1 flex items-center"},[x(w,{name:"icon-trash",class:"text-2xl -ml-2"}),h(" Löschen ")],512),[[A,!r(a).deletionConfirmed]]),C((i(),l("button",{onClick:s[1]||(s[1]=D=>g()),class:"border-2 border-lightRed hover:border-lightRed/50 text-lightRed hover:text-lightRed/70 rounded px-4 py-1 flex items-center"},[x(w,{name:"icon-check",class:"text-2xl -ml-2"}),h(" Sicher? ")])),[[A,r(a).deletionConfirmed],[r(z),v]])])])}}}),le={class:"flex items-center"},ce=n("div",null,"Buchung",-1),pe={class:"flex items-center gap-2"},ge={class:"border border-darkGrey px-2 rounded"},ue={class:"border border-darkGrey px-2 rounded"},me={key:0,class:"p-4 border-t border-grey border-opacity-20 flex flex-col"},be={class:"flex items-center justify-between border-b border-grey border-opacity-20 last:border-b-0 py-1 px-2"},ke={class:""},fe={class:""},ye={key:0,class:"bg-white rounded p-2 shadow-lg mt-4 flex items-center justify-center"},ve={key:1,class:"bg-white rounded p-2 shadow-lg mt-4 flex items-center justify-center"},he={key:2,class:"bg-white rounded p-2 shadow-lg mt-4 flex items-center justify-between"},xe=j({__name:"BookingAppointment",props:{booking:{}},emits:["refreshBookings"],setup(S,{emit:f}){const{pb:y}=E(),{sendMail:_}=J(),e=S,p=f,v=b=>new Date(b.split(".")[0]).toLocaleDateString("de-DE",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"}),a=b=>{var t,o;return(o=(t=H.find(d=>d.type==="appointmentTypes").options)==null?void 0:t.find(d=>d.value===b))==null?void 0:o.label},g=b=>{var t,o;return(o=(t=H.find(d=>d.type==="services").options)==null?void 0:t.find(d=>d.value===b))==null?void 0:o.label},c=async()=>{await y.collection("bookings").update(e.booking.id,{deleted:!0,confirmed:!1}),u.deletionConfirmed=!1,p("refreshBookings")},s=async()=>{await y.collection("bookings").update(e.booking.id,{deleted:!1}),p("refreshBookings")},w=async()=>{e.booking.start,e.booking.end;const b=new Date(e.booking.start).getFullYear(),m=String(new Date(e.booking.start).getMonth()+1).padStart(2,"0"),t=String(new Date(e.booking.start).getDate()).padStart(2,"0"),o=e.booking.start.split(" ")[1].split(":")[0],d=e.booking.start.split(":")[1].split(":")[0],$={firstName:e.booking.firstName,lastName:e.booking.lastName,mail:e.booking.mail,phone:e.booking.phone,appointmentType:e.booking.appointmentType,service:e.booking.service,place:e.booking.place,description:e.booking.description,invoiceAddress:e.booking.invoiceAddress,timeslot:{year:b,month:m,day:t,timeslot:`${o}:${d}`}};await y.collection("bookings").update(e.booking.id,{confirmed:!0}),await _("bookingConfirmationUser",e.booking.mail,$),p("refreshBookings")},D=()=>{u.deletionConfirmed=!1},u=F({deletionConfirmed:!1,isOpen:!1,formEntries:[{name:"Vorname",value:e.booking.firstName},{name:"Nachname",value:e.booking.lastName},{name:"E-Mail",value:e.booking.mail},{name:"Telefonnummer",value:e.booking.phone},{name:"Terminart",value:a(e.booking.appointmentType)},{name:"Leistung",value:g(e.booking.service)},{name:"Ort",value:e.booking.place},{name:"Thema",value:e.booking.description},{name:"Rechnungsadresse",value:e.booking.invoiceAddress}]});return(b,m)=>{const t=M;return i(),l("div",{class:q([[e.booking.deleted?"bg-red opacity-20":"",e.booking.confirmed?"bg-green":"",{"bg-offwhite":!e.booking.deleted&&!e.booking.confirmed}],"select-none border border-darkGrey border-opacity-40 rounded"])},[n("button",{"aria-label":"Buchung öffnen",onClick:m[0]||(m[0]=o=>r(u).isOpen=!r(u).isOpen),class:"w-full flex items-center justify-between p-4"},[n("div",le,[ce,r(u).isOpen?(i(),O(t,{key:1,name:"icon-triangle_up",class:"text-xl"})):(i(),O(t,{key:0,name:"icon-triangle_down",class:"text-xl"}))]),n("div",pe,[n("span",ge,B(v(b.booking.start)),1),h(" - "),n("span",ue,B(v(b.booking.end)),1)])]),r(u).isOpen?(i(),l("div",me,[n("div",null,[(i(!0),l(U,null,P(r(u).formEntries,(o,d)=>(i(),l("div",be,[n("div",ke,B(o.name),1),n("div",fe,B(o.value),1)]))),256))]),e.booking.deleted?(i(),l("div",ye,[n("button",{onClick:s,class:"border-2 border-sand/70 hover:border-sand text-coffee/70 hover:text-coffee rounded px-4 py-1 flex items-center"}," Reaktivieren ")])):e.booking.confirmed?(i(),l("div",ve," Bestätigt ")):(i(),l("div",he,[C(n("button",{onClick:m[1]||(m[1]=o=>r(u).deletionConfirmed=!0),class:"border-2 border-red/50 hover:border-red text-red/70 hover:text-red rounded px-4 py-1 flex items-center"},[x(t,{name:"icon-trash",class:"text-2xl -ml-2"}),h(" Löschen ")],512),[[A,!r(u).deletionConfirmed]]),C((i(),l("button",{onClick:m[2]||(m[2]=o=>c()),class:"border-2 border-red/50 hover:border-red text-red/70 hover:text-red rounded px-4 py-1 flex items-center"},[x(t,{name:"icon-check",class:"text-2xl -ml-2"}),h(" Sicher? ")])),[[A,r(u).deletionConfirmed],[r(z),D]]),n("button",{onClick:w,class:"border-2 border-green/70 hover:border-green text-green/70 hover:text-green rounded px-4 py-1 flex items-center"},[x(t,{name:"icon-check",class:"text-2xl -ml-2"}),h(" Bestätigen ")])]))])):R("",!0)],2)}}}),_e={key:0,class:"max-container"},$e={class:"flex items-center justify-between mt-10 mb-4 border border-grey border-opacity-20 shadow-lg rounded p-2"},we={class:"flex items-center gap-2"},De={class:"flex items-center gap-2"},Be=["value"],Ce=["value"],Se={class:"mb-10"},Te={key:0,class:"flex justify-center"},Ne={key:1,class:"flex flex-col gap-4 mb-20"},Re={class:""},Ve=j({__name:"buchungen",async setup(S){let f,y;const _=Z(),{pb:e}=E(),p=t=>{const o=t.getFullYear(),d=String(t.getMonth()+1).padStart(2,"0"),$=String(t.getDate()).padStart(2,"0");return String(t.getHours()).padStart(2,"0"),String(t.getMinutes()).padStart(2,"0"),String(t.getSeconds()).padStart(2,"0"),`${o}-${d}-${$}`},v=t=>{const o=t,d=String(o.getHours()).padStart(2,"0"),$=String(o.getMinutes()).padStart(2,"0"),N=String(o.getSeconds()).padStart(2,"0");return`${d}:${$}:${N}`},a=async(t,o)=>{o==="start"&&(s.start=g(new Date(t.target.value)),s.end=c(new Date(t.target.value))),o==="end"&&(s.end=c(new Date(t.target.value))),await T("bookings")},g=t=>new Date(new Date(t).setHours(0,0,0)),c=t=>new Date(new Date(t).setHours(23,59,59)),s=F({start:g(new Date),end:c(new Date(g(new Date).setDate(c(new Date).getDate()+7))),type:void 0}),w=G(()=>s.type?` && bookingType = "${s.type}"`:""),D=G(()=>`(end >= "${p(s.start)} ${v(s.start)}" && start <= "${p(s.end)} ${v(s.end)}")${w.value}`),u=async t=>{s.type=t,console.log(D.value),await T("bookings")},{pending:b,data:m}=([f,y]=I(()=>K("bookings",()=>e.collection("bookings").getFullList(200,{filter:D.value,sort:"-start"}))),f=await f,y(),f);return(t,o)=>{const d=te,$=M,N=de,L=xe;return r(_).token?(i(),l("div",_e,[n("div",$e,[n("div",we,[n("button",{onClick:o[0]||(o[0]=k=>u(void 0)),class:"border border-grey border-opacity-20 rounded px-4 py-1"},"Alle"),n("button",{onClick:o[1]||(o[1]=k=>u("block")),class:"border border-grey border-opacity-20 rounded px-4 py-1"},"Block"),n("button",{onClick:o[2]||(o[2]=k=>u("appointment")),class:"border border-grey border-opacity-20 rounded px-4 py-1"},"Buchung")]),n("div",De,[n("input",{type:"date",value:p(r(s).start),onChange:o[3]||(o[3]=k=>a(k,"start")),class:"border border-grey border-opacity-20 rounded px-4 py-1"},null,40,Be),n("input",{type:"date",value:p(r(s).end),onChange:o[4]||(o[4]=k=>a(k,"end")),class:"border border-grey border-opacity-20 rounded px-4 py-1"},null,40,Ce)])]),n("div",Se,[x(d,{onCreatedBlock:o[5]||(o[5]=k=>("refreshNuxtData"in t?t.refreshNuxtData:r(T))("bookings"))})]),r(b)?(i(),l("div",Te,[x($,{name:"icon-pending",class:"text-4xl inline-block animate-spin"})])):(i(),l("div",Ne,[(i(!0),l(U,null,P(r(m),(k,Ae)=>(i(),l("div",Re,[k.bookingType==="block"?(i(),O(N,{key:0,onRefreshBookings:o[6]||(o[6]=Y=>("refreshNuxtData"in t?t.refreshNuxtData:r(T))("bookings")),booking:k},null,8,["booking"])):R("",!0),k.bookingType==="appointment"?(i(),O(L,{key:1,onRefreshBookings:o[7]||(o[7]=Y=>("refreshNuxtData"in t?t.refreshNuxtData:r(T))("bookings")),booking:k},null,8,["booking"])):R("",!0)]))),256))]))])):R("",!0)}}});export{Ve as default};
