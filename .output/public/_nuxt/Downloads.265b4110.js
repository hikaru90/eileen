import{_ as j}from"./IntersectonPop.vue.1cd2e498.js";import{_ as A}from"./nuxt-icon.vue.17f4aeb4.js";import{a as B,m as V,e as z,R as I,r as T,p as O,P as F,o as r,f as l,h as t,i as g,w as N,l as H,u as a,q,v as h,x as Q,y as Z,z as S,F as _,j as x,t as u,Q as G,D as k}from"./entry.714c7b7e.js";import{u as J}from"./composables.9130a2d4.js";import{d as K}from"./defaults.24cc49a8.js";import{g as W,s as X}from"./helpers.37c70a75.js";import"./image-options.bca13af2.js";const Y={class:"py-16 md:py-24 relative"},ee={class:"max-container h-full relative z-10"},te={class:"h-full flex items-center justify-center"},se={class:"mt-10"},ne=["innerHTML"],ie={class:"flex-grow flex flex-col md:flex-row md:flex-wrap"},oe={key:0,class:"w-full md:w-1/2 shadow-2xl shadow-coffee/10 rounded-lg overflow-hidden bg-white relative border border-coffee border-opacity-10 py-4 px-5"},re=t("h3",{class:"font-heading text-lg md:text-2xl mb-4 mt-1 ml-1"},"Datei herunterladen",-1),le=t("p",{class:"pl-1"}," Um diese Datei herunterzuladen, gib bitte Deine E-Mail-Adresse ein um Dich in meinem Newsletter einzutragen. Ich verwende Deine Daten ausschließlich um neue Meditationen und Inspiration mit Dir zu teilen. Ich werde Deine E-Mail-Adresse nicht für andere Zwecke verwenden oder weitergeben, versprochen. ",-1),ae={class:"relative"},ce=["onSubmit"],de={class:"animate-spin"},ue=t("input",{type:"submit",class:"hidden"},null,-1),fe={class:"bg-lightRed px-3 py-1 text-darkRed rounded-lg"},me={class:"bg-green px-3 py-1 text-white rounded-lg"},pe={class:"mb-4 font-heading text-lg lg:text-xl gap-4 border-b border-coffee border-opacity-10 px-6 py-3 flex items-center justify-between"},be={class:"font-body text-sm text-coffee/50"},ge={class:"px-6 pt-1 pb-5"},he={class:"flex gap-10"},_e={class:"flex-grow"},xe={class:"pl-1"},we=["onClick"],ve={class:"flex items-center justify-center gap-1 pl-3 pr-2 py-1 border border-grey/20 rounded-full hover:bg-salmon/80 text-coffee hover:text-white transition"},$e=B({__name:"Downloads",props:{component:{default:{content:K.find(m=>m.type==="heroBig").content}},isFirst:{type:Boolean,default:!1}},async setup(m){let f,w;const v=m,{pb:p}=V(),y=z(),D=([f,w]=I(()=>p.collection("downloads").getFullList(200)),f=await f,w(),f),e=T({newsletterSignupOpen:!1,mail:"",subscriptionPending:!1,subscriptionSubmitted:!1,errors:[],successes:[],userSubribed:!1}),E=(s,i)=>J()(`${y.SERVER_URL}/api/files/downloads/${s}/${i}`,{format:"webp"}),b=s=>{e.errors.push(s),setTimeout(()=>{R()},3e3)},R=()=>{e.errors=[]},L=s=>{X("subscribed",!0),e.successes.push(s),e.mail="",setTimeout(()=>{P()},3e3)},P=()=>{e.successes=[]},$=s=>{if(s.includes("@")&&s.includes(".")){const i=s.split("@");if(i.length===2&&i[1].includes("."))return!0}return!1},M=async()=>{if(!e.mail){b("Bitte gib eine E-Mail ein.");return}if(!$(e.mail)){b("Bitte gib eine gültige E-Mail Adresse ein.");return}if(!e.subscriptionPending){e.subscriptionPending=!0;try{if((await p.collection("subscriptions").getList(1,50,{filter:`mail = "${e.mail}"`})).items.length>0){b("Diese E-Mail Adresse ist bereits registriert."),e.subscriptionPending=!1;return}const i=await p.collection("subscriptions").create({mail:e.mail});return L("Du hast Dich erfolgreich eingetragen."),e.subscriptionPending=!1,e.userSubribed=!0,e.newsletterSignupOpen=!1,!0}catch(s){console.log("err",s),e.subscriptionPending=!1}setTimeout(()=>{e.subscriptionPending=!1},1e3)}},U=async(s,i)=>{try{const c=`${y.public.SERVER_URL}/api/files/downloads/${s}/${i}`;console.log("url",c);const d=await $fetch(c);console.log("download res",d);const n=new Blob([d],{type:d.type}),o=document.createElement("a");o.setAttribute("href",URL.createObjectURL(n)),o.setAttribute("download",i),o.setAttribute("target","_blank"),o.click(),URL.revokeObjectURL(o.href)}catch(c){console.log("error in downloading template",c)}},C=(s,i)=>{if(console.log("state.userSubribed",e.userSubribed),!e.userSubribed){e.newsletterSignupOpen=!0;return}U(s,i)};return O(()=>{W("subscribed")&&(e.userSubribed=!0)}),F(()=>{}),(s,i)=>{const c=j,d=A;return r(),l("div",Y,[t("div",ee,[t("div",te,[t("div",se,[g(c,null,{default:N(()=>[v.component.content.heading?(r(),l("h2",{key:0,style:{"max-width":"15em"},class:"shiny-pop text-salmon font-heading text-2xl sm:text-5xl md:text-6xl lg:text-7xl mb-10 lg:mb-20 text-center",innerHTML:s.$mdRenderer.set({html:!0}).render(v.component.content.heading)},null,8,ne)):H("",!0)]),_:1})]),t("div",ie,[a(e).newsletterSignupOpen?(r(),l("div",oe,[re,le,t("div",ae,[t("form",{onSubmit:q(M,["prevent"]),class:"flex items-center gap-4 justify-start mt-5 mb-1"},[h(t("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=n=>a(e).mail=n),placeholder:"E-Mail Adresse",class:"px-5 py-2 shadow-xl shadow-coffee/5 rounded-full flex-grow border border-coffee border-opacity-10"},null,512),[[Q,a(e).mail]]),t("button",{type:"submit",class:Z([[{"pointer-events-none cursor-default":a(e).subscriptionPending}],"shadow-xl shadow-coffee/20 bg-salmon px-5 py-2 rounded-full text-white flex-shrink-0 flex items-center justify-center"])},[h(t("div",null,"Eintragen",512),[[S,!a(e).subscriptionPending]]),h(t("div",de,[g(d,{name:"icon-pending",class:"text-2xl text-white"})],512),[[S,a(e).subscriptionPending]])],2),ue],40,ce),(r(!0),l(_,null,x(a(e).errors,(n,o)=>(r(),l("div",{key:o,class:"w-full mt-4"},[t("div",fe,u(n),1)]))),128)),(r(!0),l(_,null,x(a(e).successes,(n,o)=>(r(),l("div",{key:o,class:"mt-4"},[t("div",me,u(n),1)]))),128))])])):(r(!0),l(_,{key:1},x(a(D),(n,o)=>(r(),l("div",{key:"audio"+o,class:"w-full md:w-1/2 shadow-2xl shadow-coffee/10 rounded-lg overflow-hidden bg-white relative border border-coffee border-opacity-10 flex"},[t("div",{style:G([{backgroundImage:`url(${E(n.id,n.thumbnail)})`}]),class:"relative w-1/3 h-full bg-cover bg-center flex-grow-0 flex-shrink-0"},null,4),t("div",null,[t("div",pe,[k(u(n.name)+" ",1),t("div",be,u(new Date(n.created).toLocaleDateString("de-DE")),1)]),t("div",ge,[t("div",he,[t("div",_e,[t("div",xe,u(n.description),1),t("button",{onClick:ye=>C(n.id,n.file),class:"flex items-center justify-center flex-shrink-0 mt-4 mb-1"},[t("div",ve,[k(" Herunterladen "),g(d,{name:"icon-download",class:"text-2xl -ml-1"})])],8,we)])])])])]))),128))])])])])}}});export{$e as default};
