import{_ as j}from"./B4ykcIyl.js";import{_ as z}from"./BgVKTi7K.js";import{f as T,u as V,k as I,r as O,m as F,M as N,o as r,c as o,a as t,b as x,w as H,v as Z,F as _,x as w,n as l,C as q,A as v,E as G,z as J,B as D,t as f,S as K,d as E,T as Q}from"./k1IzlGhG.js";import{u as W}from"./NQ833bWe.js";import{d as X}from"./F1WjrixK.js";import{g as Y,s as ee}from"./BH53taJr.js";import"./zu2oJgjb.js";const te={class:"py-16 md:py-24 relative"},se={class:"max-container h-full relative z-10"},ie={class:"h-full flex items-center justify-center"},ne={class:"mt-10"},re=["innerHTML"],oe={class:"flex-grow flex flex-col md:flex-row md:flex-wrap -mx-3"},le={key:0,class:"shadow-2xl shadow-coffee/10 rounded-lg overflow-hidden bg-white relative border border-coffee border-opacity-10 py-4 px-5"},ae=t("h3",{class:"font-heading text-lg md:text-2xl mb-4 mt-1 ml-1"},"Datei herunterladen",-1),ce=t("p",{class:"pl-1"}," Um diese Datei herunterzuladen, gib bitte Deine E-Mail-Adresse ein. Damit trägst Du Dich gleichzeitig in meinen Newsletter ein. Ich verwende Deine Daten ausschließlich um neue Meditationen und Inspiration mit Dir zu teilen. Ich werde Deine E-Mail-Adresse nicht für andere Zwecke verwenden oder weitergeben, versprochen. ",-1),de={class:"relative"},ue={class:"animate-spin"},fe=t("input",{type:"submit",class:"hidden"},null,-1),pe={class:"bg-lightRed px-3 py-1 text-darkRed rounded-lg"},me={class:"bg-green px-3 py-1 text-white rounded-lg"},be={key:1,class:"shadow-2xl shadow-coffee/10 rounded-lg overflow-hidden bg-white relative border border-coffee border-opacity-10 flex h-full"},ge={class:"mb-4 font-heading text-lg lg:text-xl gap-4 border-b border-coffee border-opacity-10 px-6 py-3 flex items-center justify-between"},he={class:"font-body text-sm text-coffee/50"},xe={class:"px-6 pt-1 pb-5"},_e={class:"flex gap-10"},we={class:"flex-grow"},ve={class:"pl-1"},ye=["onClick"],ke={class:"flex items-center justify-center gap-1 pl-3 pr-2 py-1 border border-grey/20 rounded-full hover:bg-salmon/80 text-coffee hover:text-white transition capitalize"},Ce=T({__name:"Downloads",props:{component:{default:{content:X.find(m=>m.type==="heroBig").content}},isFirst:{type:Boolean,default:!1}},async setup(m){let p,y;const{pb:b}=V(),k=Q(),S=m,L=([p,y]=I(()=>b.collection("downloads").getFullList(200)),p=await p,y(),p),e=O({newsletterSignupOpen:!1,mail:"",subscriptionPending:!1,subscriptionSubmitted:!1,errors:[],successes:[],userSubribed:!1}),R=(s,i)=>W()(`${k.public.SERVER_URL}/api/files/downloads/${s}/${i}`,{format:"webp"}),g=s=>{e.errors.push(s),setTimeout(()=>{M()},3e3)},M=()=>{e.errors=[]},$=s=>{ee("subscribed",!0),e.successes.push(s),e.mail="",setTimeout(()=>{C()},3e3)},C=()=>{e.successes=[]},P=s=>{if(s.includes("@")&&s.includes(".")){const i=s.split("@");if(i.length===2&&i[1].includes("."))return!0}return!1},U=async()=>{if(!e.mail){g("Bitte gib eine E-Mail ein.");return}if(!P(e.mail)){g("Bitte gib eine gültige E-Mail Adresse ein.");return}if(!e.subscriptionPending){e.subscriptionPending=!0;try{if((await b.collection("subscriptions").getList(1,50,{filter:`mail = "${e.mail}"`})).items.length>0){g("Diese E-Mail Adresse ist bereits registriert."),e.subscriptionPending=!1;return}const i=await b.collection("subscriptions").create({mail:e.mail});return $("Du hast Dich erfolgreich eingetragen."),e.subscriptionPending=!1,e.userSubribed=!0,e.newsletterSignupOpen=!1,!0}catch(s){console.log("err",s),e.subscriptionPending=!1}setTimeout(()=>{e.subscriptionPending=!1},1e3)}},A=async(s,i)=>{try{const a=`${k.public.SERVER_URL}/api/files/downloads/${s}/${i}`;console.log("url",a);const c=await $fetch(a);console.log("download res",c);const n=new Blob([c],{type:c.type}),d=document.createElement("a");d.setAttribute("href",URL.createObjectURL(n)),d.setAttribute("download",i),d.setAttribute("target","_blank"),d.click(),URL.revokeObjectURL(d.href)}catch(a){console.log("error in downloading template",a)}},B=(s,i)=>{if(console.log("state.userSubribed",e.userSubribed),!e.userSubribed){e.newsletterSignupOpen=!0;return}A(s,i)};return F(()=>{Y("subscribed")&&(e.userSubribed=!0)}),N(()=>{}),(s,i)=>{const a=j,c=z;return r(),o("div",te,[t("div",se,[t("div",ie,[t("div",ne,[x(a,null,{default:H(()=>[S.component.content.heading?(r(),o("h2",{key:0,style:{"max-width":"15em"},class:"shiny-pop text-salmon font-heading text-2xl sm:text-5xl md:text-6xl lg:text-7xl mb-10 lg:mb-20 text-center",innerHTML:s.$mdRenderer.set({html:!0}).render(S.component.content.heading)},null,8,re)):Z("",!0)]),_:1})]),t("div",oe,[(r(!0),o(_,null,w(l(L),(n,d)=>(r(),o("div",{class:"px-3 w-full md:w-1/2",key:"audio"+d},[l(e).newsletterSignupOpen?(r(),o("div",le,[ae,ce,t("div",de,[t("form",{onSubmit:q(U,["prevent"]),class:"flex items-center gap-4 justify-start mt-5 mb-1"},[v(t("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=u=>l(e).mail=u),placeholder:"E-Mail Adresse",class:"px-5 py-2 shadow-xl shadow-coffee/5 rounded-full flex-grow border border-coffee border-opacity-10"},null,512),[[G,l(e).mail]]),t("button",{type:"submit",class:J([[{"pointer-events-none cursor-default":l(e).subscriptionPending}],"shadow-xl shadow-coffee/20 bg-salmon px-5 py-2 rounded-full text-white flex-shrink-0 flex items-center justify-center"])},[v(t("div",null,"Eintragen",512),[[D,!l(e).subscriptionPending]]),v(t("div",ue,[x(c,{name:"icon-pending",class:"text-2xl text-white"})],512),[[D,l(e).subscriptionPending]])],2),fe],32),(r(!0),o(_,null,w(l(e).errors,(u,h)=>(r(),o("div",{key:h,class:"w-full mt-4"},[t("div",pe,f(u),1)]))),128)),(r(!0),o(_,null,w(l(e).successes,(u,h)=>(r(),o("div",{key:h,class:"mt-4"},[t("div",me,f(u),1)]))),128))])])):(r(),o("div",be,[t("div",{style:K([{backgroundImage:`url(${R(n.id,n.thumbnail)})`}]),class:"relative w-1/3 h-full bg-cover bg-center flex-grow-0 flex-shrink-0"},null,4),t("div",null,[t("div",ge,[E(f(n.name)+" ",1),t("div",he,f(new Date(n.created).toLocaleDateString("de-DE")),1)]),t("div",xe,[t("div",_e,[t("div",we,[t("div",ve,f(n.description),1),t("button",{onClick:u=>B(n.id,n.file),class:"flex items-center justify-center flex-shrink-0 mt-4 mb-1"},[t("div",ke,[E(f(n.filetype)+" Herunterladen ",1),x(c,{name:"icon-download",class:"text-2xl -ml-1"})])],8,ye)])])])])]))]))),128))])])])])}}});export{Ce as default};
