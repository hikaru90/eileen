import{_ as j}from"./DR3C1UCQ.js";import{f as M,u as E,r as F,o as i,c as l,a as n,A as B,E as V,n as r,d as h,b as _,t as D,B as R,q as A,F as P,x as U,v as O,z as q,g as J,l as G,k as Z}from"./BtqrO9Ir.js";import{v as z}from"./BeZ6WN2L.js";import{d as H}from"./F1WjrixK.js";import{r as T,u as I}from"./RkGtJdge.js";const K={class:"border border-dashed border-darkGrey border-opacity-40 rounded pl-4 p-2 flex items-center justify-between"},Q=n("div",{class:""},"Neuen Block erstellen",-1),W={class:"flex items-center gap-4"},X={class:"flex items-center gap-2"},ee=M({__name:"BookingBlockCreator",emits:["createdBlock"],setup(C,{emit:y}){const{pb:v}=E(),e=y,a=F({booking:{start:void 0,end:void 0},deletionConfirmed:!1}),b=d=>{const u=d.split("T")[0],c=d.split("T")[1];return`${u} ${c}:00.123Z`},x=async()=>{const d={bookingType:"block",start:b(a.booking.start),end:b(a.booking.end)};await v.collection("bookings").create(d),a.booking.start=void 0,a.booking.end=void 0,e("createdBlock")};return(d,u)=>{const c=j;return i(),l("div",K,[Q,n("div",W,[n("div",X,[B(n("input",{type:"datetime-local","onUpdate:modelValue":u[0]||(u[0]=s=>r(a).booking.start=s),class:"border border-grey border-opacity-20 rounded px-4 py-1"},null,512),[[V,r(a).booking.start]]),h(" - "),B(n("input",{type:"datetime-local","onUpdate:modelValue":u[1]||(u[1]=s=>r(a).booking.end=s),class:"border border-grey border-opacity-20 rounded px-4 py-1"},null,512),[[V,r(a).booking.end]])]),n("button",{onClick:x,class:"border-2 border-green hover:border-green/50 text-green hover:text-green/70 rounded px-4 py-1 flex items-center"},[_(c,{name:"icon-trash",class:"text-2xl -ml-2"}),h(" Erstellen ")])])])}}}),te={class:"border border-grey bg-gradient-to-r from-grey to-offwhite rounded p-4 flex items-center justify-between"},oe=n("div",{class:"text-darkOffwhite"},"Block",-1),ne={class:"flex items-center gap-4"},re={class:"flex items-center gap-2"},se={class:"border border-darkGrey px-2 rounded"},ie={class:"border border-darkGrey px-2 rounded"},ae=M({__name:"BookingBlock",props:{booking:{}},emits:["refreshBookings"],setup(C,{emit:y}){const{pb:v}=E(),e=C,a=y,b=c=>new Date(c.split(".")[0]).toLocaleDateString("de-DE",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"}),x=()=>{d.deletionConfirmed=!1},d=F({deletionConfirmed:!1}),u=async()=>{await v.collection("bookings").delete(e.booking.id),d.deletionConfirmed=!1,a("refreshBookings")};return(c,s)=>{const w=j;return i(),l("div",te,[oe,n("div",ne,[n("div",re,[n("span",se,D(b(c.booking.start)),1),h(" - "),n("span",ie,D(b(c.booking.end)),1)]),B(n("button",{onClick:s[0]||(s[0]=p=>r(d).deletionConfirmed=!0),class:"border-2 border-lightRed hover:border-lightRed/50 text-lightRed hover:text-lightRed/70 rounded px-4 py-1 flex items-center"},[_(w,{name:"icon-trash",class:"text-2xl -ml-2"}),h(" Löschen ")],512),[[R,!r(d).deletionConfirmed]]),B((i(),l("button",{onClick:s[1]||(s[1]=p=>u()),class:"border-2 border-lightRed hover:border-lightRed/50 text-lightRed hover:text-lightRed/70 rounded px-4 py-1 flex items-center"},[_(w,{name:"icon-check",class:"text-2xl -ml-2"}),h(" Sicher? ")])),[[R,r(d).deletionConfirmed],[r(z),x]])])])}}}),de={class:"flex items-center"},le=n("div",null,"Buchung",-1),ce={class:"flex items-center gap-2"},pe={class:"border border-darkGrey px-2 rounded"},ge={class:"border border-darkGrey px-2 rounded"},ue={key:0,class:"p-4 border-t border-grey border-opacity-20 flex flex-col"},me={class:"flex items-center justify-between border-b border-grey border-opacity-20 last:border-b-0 py-1 px-2"},be={class:""},ke={class:""},fe={key:0,class:"bg-white rounded p-2 shadow-lg mt-4 flex items-center justify-center"},ye={key:1,class:"bg-white rounded p-2 shadow-lg mt-4 flex items-center justify-center"},ve={key:2,class:"bg-white rounded p-2 shadow-lg mt-4 flex items-center justify-between"},he=M({__name:"BookingAppointment",props:{booking:{}},emits:["refreshBookings"],setup(C,{emit:y}){const{pb:v}=E(),e=C,a=y,b=m=>new Date(m.split(".")[0]).toLocaleDateString("de-DE",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"}),x=m=>{var g,t;return(t=(g=H.find(o=>o.type==="appointmentTypes").options)==null?void 0:g.find(o=>o.value===m))==null?void 0:t.label},d=m=>{var g,t;return(t=(g=H.find(o=>o.type==="services").options)==null?void 0:g.find(o=>o.value===m))==null?void 0:t.label},u=async()=>{await v.collection("bookings").update(e.booking.id,{deleted:!0,confirmed:!1}),p.deletionConfirmed=!1,a("refreshBookings")},c=async()=>{await v.collection("bookings").update(e.booking.id,{deleted:!1}),a("refreshBookings")},s=async()=>{e.booking.start,e.booking.end;const m=new Date(e.booking.start).getFullYear(),k=String(new Date(e.booking.start).getMonth()+1).padStart(2,"0"),g=String(new Date(e.booking.start).getDate()).padStart(2,"0"),t=e.booking.start.split(" ")[1].split(":")[0],o=e.booking.start.split(":")[1].split(":")[0],$={firstName:e.booking.firstName,lastName:e.booking.lastName,mail:e.booking.mail,phone:e.booking.phone,appointmentType:e.booking.appointmentType,service:e.booking.service,place:e.booking.place,description:e.booking.description,invoiceAddress:e.booking.invoiceAddress,timeslot:{year:m,month:k,day:g,timeslot:`${t}:${o}`}};await v.collection("bookings").update(e.booking.id,{confirmed:!0}),await fetch("/api/mail/sendMail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({template:"bookingConfirmationUser",recipient:e.booking.mail,formData:$})}),a("refreshBookings")},w=()=>{p.deletionConfirmed=!1},p=F({deletionConfirmed:!1,isOpen:!1,formEntries:[{name:"Vorname",value:e.booking.firstName},{name:"Nachname",value:e.booking.lastName},{name:"E-Mail",value:e.booking.mail},{name:"Telefonnummer",value:e.booking.phone},{name:"Terminart",value:x(e.booking.appointmentType)},{name:"Leistung",value:d(e.booking.service)},{name:"Ort",value:e.booking.place},{name:"Thema",value:e.booking.description},{name:"Rechnungsadresse",value:e.booking.invoiceAddress}]});return(m,k)=>{const g=j;return i(),l("div",{class:q([[e.booking.deleted?"bg-red opacity-20":"",e.booking.confirmed?"bg-green":"",{"bg-offwhite":!e.booking.deleted&&!e.booking.confirmed}],"select-none border border-darkGrey border-opacity-40 rounded"])},[n("button",{"aria-label":"Buchung öffnen",onClick:k[0]||(k[0]=t=>r(p).isOpen=!r(p).isOpen),class:"w-full flex items-center justify-between p-4"},[n("div",de,[le,r(p).isOpen?(i(),A(g,{key:1,name:"icon-triangle_up",class:"text-xl"})):(i(),A(g,{key:0,name:"icon-triangle_down",class:"text-xl"}))]),n("div",ce,[n("span",pe,D(b(m.booking.start)),1),h(" - "),n("span",ge,D(b(m.booking.end)),1)])]),r(p).isOpen?(i(),l("div",ue,[n("div",null,[(i(!0),l(P,null,U(r(p).formEntries,(t,o)=>(i(),l("div",me,[n("div",be,D(t.name),1),n("div",ke,D(t.value),1)]))),256))]),e.booking.deleted?(i(),l("div",fe,[n("button",{onClick:c,class:"border-2 border-sand/70 hover:border-sand text-coffee/70 hover:text-coffee rounded px-4 py-1 flex items-center"}," Reaktivieren ")])):e.booking.confirmed?(i(),l("div",ye," Bestätigt ")):(i(),l("div",ve,[B(n("button",{onClick:k[1]||(k[1]=t=>r(p).deletionConfirmed=!0),class:"border-2 border-red/50 hover:border-red text-red/70 hover:text-red rounded px-4 py-1 flex items-center"},[_(g,{name:"icon-trash",class:"text-2xl -ml-2"}),h(" Löschen ")],512),[[R,!r(p).deletionConfirmed]]),B((i(),l("button",{onClick:k[2]||(k[2]=t=>u()),class:"border-2 border-red/50 hover:border-red text-red/70 hover:text-red rounded px-4 py-1 flex items-center"},[_(g,{name:"icon-check",class:"text-2xl -ml-2"}),h(" Sicher? ")])),[[R,r(p).deletionConfirmed],[r(z),w]]),n("button",{onClick:s,class:"border-2 border-green/70 hover:border-green text-green/70 hover:text-green rounded px-4 py-1 flex items-center"},[_(g,{name:"icon-check",class:"text-2xl -ml-2"}),h(" Bestätigen ")])]))])):O("",!0)],2)}}}),xe={key:0,class:"max-container"},_e={class:"flex items-center justify-between mt-10 mb-4 border border-grey border-opacity-20 shadow-lg rounded p-2"},$e={class:"flex items-center gap-2"},we={class:"flex items-center gap-2"},De=["value"],Be=["value"],Ce={class:"mb-10"},Se={key:0,class:"flex justify-center"},Te={key:1,class:"flex flex-col gap-4 mb-20"},Ne={class:""},Fe=M({__name:"buchungen",async setup(C){let y,v;const e=J(),{pb:a}=E(),b=t=>{const o=t.getFullYear(),$=String(t.getMonth()+1).padStart(2,"0"),S=String(t.getDate()).padStart(2,"0");return String(t.getHours()).padStart(2,"0"),String(t.getMinutes()).padStart(2,"0"),String(t.getSeconds()).padStart(2,"0"),`${o}-${$}-${S}`},x=t=>{const o=t,$=String(o.getHours()).padStart(2,"0"),S=String(o.getMinutes()).padStart(2,"0"),N=String(o.getSeconds()).padStart(2,"0");return`${$}:${S}:${N}`},d=async(t,o)=>{o==="start"&&(s.start=u(new Date(t.target.value)),s.end=c(new Date(t.target.value))),o==="end"&&(s.end=c(new Date(t.target.value))),await T("bookings")},u=t=>new Date(new Date(t).setHours(0,0,0)),c=t=>new Date(new Date(t).setHours(23,59,59)),s=F({start:u(new Date),end:c(new Date(u(new Date).setDate(c(new Date).getDate()+7))),type:void 0}),w=G(()=>s.type?` && bookingType = "${s.type}"`:""),p=G(()=>`(end >= "${b(s.start)} ${x(s.start)}" && start <= "${b(s.end)} ${x(s.end)}")${w.value}`),m=async t=>{s.type=t,console.log(p.value),await T("bookings")},{pending:k,data:g}=([y,v]=Z(()=>I("bookings",()=>a.collection("bookings").getFullList(200,{filter:p.value,sort:"-start"}))),y=await y,v(),y);return(t,o)=>{const $=ee,S=j,N=ae,L=he;return r(e).token?(i(),l("div",xe,[n("div",_e,[n("div",$e,[n("button",{onClick:o[0]||(o[0]=f=>m(void 0)),class:"border border-grey border-opacity-20 rounded px-4 py-1"},"Alle"),n("button",{onClick:o[1]||(o[1]=f=>m("block")),class:"border border-grey border-opacity-20 rounded px-4 py-1"},"Block"),n("button",{onClick:o[2]||(o[2]=f=>m("appointment")),class:"border border-grey border-opacity-20 rounded px-4 py-1"},"Buchung")]),n("div",we,[n("input",{type:"date",value:b(r(s).start),onChange:o[3]||(o[3]=f=>d(f,"start")),class:"border border-grey border-opacity-20 rounded px-4 py-1"},null,40,De),n("input",{type:"date",value:b(r(s).end),onChange:o[4]||(o[4]=f=>d(f,"end")),class:"border border-grey border-opacity-20 rounded px-4 py-1"},null,40,Be)])]),n("div",Ce,[_($,{onCreatedBlock:o[5]||(o[5]=f=>("refreshNuxtData"in t?t.refreshNuxtData:r(T))("bookings"))})]),r(k)?(i(),l("div",Se,[_(S,{name:"icon-pending",class:"text-4xl inline-block animate-spin"})])):(i(),l("div",Te,[(i(!0),l(P,null,U(r(g),(f,Oe)=>(i(),l("div",Ne,[f.bookingType==="block"?(i(),A(N,{key:0,onRefreshBookings:o[6]||(o[6]=Y=>("refreshNuxtData"in t?t.refreshNuxtData:r(T))("bookings")),booking:f},null,8,["booking"])):O("",!0),f.bookingType==="appointment"?(i(),A(L,{key:1,onRefreshBookings:o[7]||(o[7]=Y=>("refreshNuxtData"in t?t.refreshNuxtData:r(T))("bookings")),booking:f},null,8,["booking"])):O("",!0)]))),256))]))])):O("",!0)}}});export{Fe as default};
