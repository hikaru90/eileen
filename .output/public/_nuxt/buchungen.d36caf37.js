import{_ as A}from"./nuxt-icon.vue.5053ddd3.js";import{a as M,m as E,r as F,o as s,f as c,h as n,v as B,x as V,u as r,D as _,i as $,t as w,z as O,c as j,F as U,j as P,l as R,y as Z,b as q,C as G,R as I}from"./entry.fb780137.js";import{v as z}from"./index.d7c74cbc.js";import{u as J}from"./useBrevo.63e4e4a4.js";import{d as H}from"./defaults.24cc49a8.js";import{r as T,u as K}from"./asyncData.a12f4912.js";const Q={class:"border border-dashed border-darkGrey border-opacity-40 rounded pl-4 p-2 flex items-center justify-between"},W=n("div",{class:""},"Neuen Block erstellen",-1),X={class:"flex items-center gap-4"},ee={class:"flex items-center gap-2"},te=M({__name:"BookingBlockCreator",emits:["createdBlock"],setup(x,{emit:m}){const{pb:e}=E(),a=F({booking:{start:void 0,end:void 0},deletionConfirmed:!1}),h=d=>{const p=d.split("T")[0],k=d.split("T")[1];return`${p} ${k}:00.123Z`},v=async()=>{const d={bookingType:"block",start:h(a.booking.start),end:h(a.booking.end)};await e.collection("bookings").create(d),a.booking.start=void 0,a.booking.end=void 0,m("createdBlock")};return(d,p)=>{const k=A;return s(),c("div",Q,[W,n("div",X,[n("div",ee,[B(n("input",{type:"datetime-local","onUpdate:modelValue":p[0]||(p[0]=l=>r(a).booking.start=l),class:"border border-grey border-opacity-20 rounded px-4 py-1"},null,512),[[V,r(a).booking.start]]),_(" - "),B(n("input",{type:"datetime-local","onUpdate:modelValue":p[1]||(p[1]=l=>r(a).booking.end=l),class:"border border-grey border-opacity-20 rounded px-4 py-1"},null,512),[[V,r(a).booking.end]])]),n("button",{onClick:v,class:"border-2 border-green hover:border-green/50 text-green hover:text-green/70 rounded px-4 py-1 flex items-center"},[$(k,{name:"icon-trash",class:"text-2xl -ml-2"}),_(" Erstellen ")])])])}}}),oe={class:"border border-grey bg-gradient-to-r from-grey to-offwhite rounded p-4 flex items-center justify-between"},ne=n("div",{class:"text-darkOffwhite"},"Block",-1),re={class:"flex items-center gap-4"},se={class:"flex items-center gap-2"},ie={class:"border border-darkGrey px-2 rounded"},ae={class:"border border-darkGrey px-2 rounded"},de=M({__name:"BookingBlock",props:{booking:null},emits:["refreshBookings"],setup(x,{emit:m}){const e=x,{pb:a}=E(),h=k=>new Date(k.split(".")[0]).toLocaleDateString("de-DE",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"}),v=()=>{d.deletionConfirmed=!1},d=F({deletionConfirmed:!1}),p=async()=>{await a.collection("bookings").delete(e.booking.id),d.deletionConfirmed=!1,m("refreshBookings")};return(k,l)=>{const i=A;return s(),c("div",oe,[ne,n("div",re,[n("div",se,[n("span",ie,w(h(x.booking.start)),1),_(" - "),n("span",ae,w(h(x.booking.end)),1)]),B(n("button",{onClick:l[0]||(l[0]=C=>r(d).deletionConfirmed=!0),class:"border-2 border-lightRed hover:border-lightRed/50 text-lightRed hover:text-lightRed/70 rounded px-4 py-1 flex items-center"},[$(i,{name:"icon-trash",class:"text-2xl -ml-2"}),_(" Löschen ")],512),[[O,!r(d).deletionConfirmed]]),B((s(),c("button",{onClick:l[1]||(l[1]=C=>p()),class:"border-2 border-lightRed hover:border-lightRed/50 text-lightRed hover:text-lightRed/70 rounded px-4 py-1 flex items-center"},[$(i,{name:"icon-check",class:"text-2xl -ml-2"}),_(" Sicher? ")])),[[O,r(d).deletionConfirmed],[r(z),v]])])])}}}),le={class:"flex items-center"},ce=n("div",null,"Buchung",-1),ue={class:"flex items-center gap-2"},pe={class:"border border-darkGrey px-2 rounded"},ge={class:"border border-darkGrey px-2 rounded"},be={key:0,class:"p-4 border-t border-grey border-opacity-20 flex flex-col"},me={class:"flex items-center justify-between border-b border-grey border-opacity-20 last:border-b-0 py-1 px-2"},ke={class:""},fe={class:""},ye={key:0,class:"bg-white rounded p-2 shadow-lg mt-4 flex items-center justify-center"},ve={key:1,class:"bg-white rounded p-2 shadow-lg mt-4 flex items-center justify-center"},xe={key:2,class:"bg-white rounded p-2 shadow-lg mt-4 flex items-center justify-between"},he=M({__name:"BookingAppointment",props:{booking:null},emits:["refreshBookings"],setup(x,{emit:m}){const e=x,{pb:a}=E(),{sendMail:h}=J(),v=f=>new Date(f.split(".")[0]).toLocaleDateString("de-DE",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"}),d=f=>{var u,t;return(t=(u=H.find(o=>o.type==="appointmentTypes").options)==null?void 0:u.find(o=>o.value===f))==null?void 0:t.label},p=f=>{var u,t;return(t=(u=H.find(o=>o.type==="services").options)==null?void 0:u.find(o=>o.value===f))==null?void 0:t.label},k=async()=>{await a.collection("bookings").update(e.booking.id,{deleted:!0,confirmed:!1}),g.deletionConfirmed=!1,m("refreshBookings")},l=async()=>{await a.collection("bookings").update(e.booking.id,{deleted:!1}),m("refreshBookings")},i=async()=>{e.booking.start,e.booking.end;const f=new Date(e.booking.start).getFullYear(),b=String(new Date(e.booking.start).getMonth()+1).padStart(2,"0"),u=String(new Date(e.booking.start).getDate()).padStart(2,"0"),t=e.booking.start.split(" ")[1].split(":")[0],o=e.booking.start.split(":")[1].split(":")[0],D={firstName:e.booking.firstName,lastName:e.booking.lastName,mail:e.booking.mail,phone:e.booking.phone,appointmentType:e.booking.appointmentType,service:e.booking.service,place:e.booking.place,description:e.booking.description,invoiceAddress:e.booking.invoiceAddress,timeslot:{year:f,month:b,day:u,timeslot:`${t}:${o}`}};await a.collection("bookings").update(e.booking.id,{confirmed:!0}),await h("bookingConfirmationUser",e.booking.mail,D),m("refreshBookings")},C=()=>{g.deletionConfirmed=!1},g=F({deletionConfirmed:!1,isOpen:!1,formEntries:[{name:"Vorname",value:e.booking.firstName},{name:"Nachname",value:e.booking.lastName},{name:"E-Mail",value:e.booking.mail},{name:"Telefonnummer",value:e.booking.phone},{name:"Terminart",value:d(e.booking.appointmentType)},{name:"Leistung",value:p(e.booking.service)},{name:"Ort",value:e.booking.place},{name:"Thema",value:e.booking.description},{name:"Rechnungsadresse",value:e.booking.invoiceAddress}]});return(f,b)=>{const u=A;return s(),c("div",{class:Z([[e.booking.deleted?"bg-red opacity-20":"",e.booking.confirmed?"bg-green":"",{"bg-offwhite":!e.booking.deleted&&!e.booking.confirmed}],"select-none border border-darkGrey border-opacity-40 rounded"])},[n("button",{"aria-label":"Buchung öffnen",onClick:b[0]||(b[0]=t=>r(g).isOpen=!r(g).isOpen),class:"w-full flex items-center justify-between p-4"},[n("div",le,[ce,r(g).isOpen?(s(),j(u,{key:1,name:"icon-triangle_up",class:"text-xl"})):(s(),j(u,{key:0,name:"icon-triangle_down",class:"text-xl"}))]),n("div",ue,[n("span",pe,w(v(x.booking.start)),1),_(" - "),n("span",ge,w(v(x.booking.end)),1)])]),r(g).isOpen?(s(),c("div",be,[n("div",null,[(s(!0),c(U,null,P(r(g).formEntries,(t,o)=>(s(),c("div",me,[n("div",ke,w(t.name),1),n("div",fe,w(t.value),1)]))),256))]),e.booking.deleted?(s(),c("div",ye,[n("button",{onClick:l,class:"border-2 border-sand/70 hover:border-sand text-coffee/70 hover:text-coffee rounded px-4 py-1 flex items-center"}," Reaktivieren ")])):e.booking.confirmed?(s(),c("div",ve," Bestätigt ")):(s(),c("div",xe,[B(n("button",{onClick:b[1]||(b[1]=t=>r(g).deletionConfirmed=!0),class:"border-2 border-red/50 hover:border-red text-red/70 hover:text-red rounded px-4 py-1 flex items-center"},[$(u,{name:"icon-trash",class:"text-2xl -ml-2"}),_(" Löschen ")],512),[[O,!r(g).deletionConfirmed]]),B((s(),c("button",{onClick:b[2]||(b[2]=t=>k()),class:"border-2 border-red/50 hover:border-red text-red/70 hover:text-red rounded px-4 py-1 flex items-center"},[$(u,{name:"icon-check",class:"text-2xl -ml-2"}),_(" Sicher? ")])),[[O,r(g).deletionConfirmed],[r(z),C]]),n("button",{onClick:i,class:"border-2 border-green/70 hover:border-green text-green/70 hover:text-green rounded px-4 py-1 flex items-center"},[$(u,{name:"icon-check",class:"text-2xl -ml-2"}),_(" Bestätigen ")])]))])):R("",!0)],2)}}}),_e={key:0,class:"max-container"},$e={class:"flex items-center justify-between mt-10 mb-4 border border-grey border-opacity-20 shadow-lg rounded p-2"},De={class:"flex items-center gap-2"},we={class:"flex items-center gap-2"},Be=["value"],Ce=["value"],Se={class:"mb-10"},Te={key:0,class:"flex justify-center"},Ne={key:1,class:"flex flex-col gap-4 mb-20"},Re={class:""},Ve=M({__name:"buchungen",async setup(x){let m,e;const a=q(),{pb:h}=E(),v=t=>{const o=t.getFullYear(),D=String(t.getMonth()+1).padStart(2,"0"),S=String(t.getDate()).padStart(2,"0");return String(t.getHours()).padStart(2,"0"),String(t.getMinutes()).padStart(2,"0"),String(t.getSeconds()).padStart(2,"0"),`${o}-${D}-${S}`},d=t=>{const o=t,D=String(o.getHours()).padStart(2,"0"),S=String(o.getMinutes()).padStart(2,"0"),N=String(o.getSeconds()).padStart(2,"0");return`${D}:${S}:${N}`},p=async(t,o)=>{o==="start"&&(i.start=k(new Date(t.target.value)),i.end=l(new Date(t.target.value))),o==="end"&&(i.end=l(new Date(t.target.value))),await T("bookings")},k=t=>new Date(new Date(t).setHours(0,0,0)),l=t=>new Date(new Date(t).setHours(23,59,59)),i=F({start:k(new Date),end:l(new Date(k(new Date).setDate(l(new Date).getDate()+7))),type:void 0}),C=G(()=>i.type?` && bookingType = "${i.type}"`:""),g=G(()=>`(end >= "${v(i.start)} ${d(i.start)}" && start <= "${v(i.end)} ${d(i.end)}")${C.value}`),f=async t=>{i.type=t,console.log(g.value),await T("bookings")},{pending:b,data:u}=([m,e]=I(()=>K("bookings",()=>h.collection("bookings").getFullList(200,{filter:g.value,sort:"-start"}))),m=await m,e(),m);return(t,o)=>{const D=te,S=A,N=de,L=he;return r(a).token?(s(),c("div",_e,[n("div",$e,[n("div",De,[n("button",{onClick:o[0]||(o[0]=y=>f(void 0)),class:"border border-grey border-opacity-20 rounded px-4 py-1"},"Alle"),n("button",{onClick:o[1]||(o[1]=y=>f("block")),class:"border border-grey border-opacity-20 rounded px-4 py-1"},"Block"),n("button",{onClick:o[2]||(o[2]=y=>f("appointment")),class:"border border-grey border-opacity-20 rounded px-4 py-1"},"Buchung")]),n("div",we,[n("input",{type:"date",value:v(r(i).start),onChange:o[3]||(o[3]=y=>p(y,"start")),class:"border border-grey border-opacity-20 rounded px-4 py-1"},null,40,Be),n("input",{type:"date",value:v(r(i).end),onChange:o[4]||(o[4]=y=>p(y,"end")),class:"border border-grey border-opacity-20 rounded px-4 py-1"},null,40,Ce)])]),n("div",Se,[$(D,{onCreatedBlock:o[5]||(o[5]=y=>("refreshNuxtData"in t?t.refreshNuxtData:r(T))("bookings"))})]),r(b)?(s(),c("div",Te,[$(S,{name:"icon-pending",class:"text-4xl inline-block animate-spin"})])):(s(),c("div",Ne,[(s(!0),c(U,null,P(r(u),(y,Oe)=>(s(),c("div",Re,[y.bookingType==="block"?(s(),j(N,{key:0,onRefreshBookings:o[6]||(o[6]=Y=>("refreshNuxtData"in t?t.refreshNuxtData:r(T))("bookings")),booking:y},null,8,["booking"])):R("",!0),y.bookingType==="appointment"?(s(),j(L,{key:1,onRefreshBookings:o[7]||(o[7]=Y=>("refreshNuxtData"in t?t.refreshNuxtData:r(T))("bookings")),booking:y},null,8,["booking"])):R("",!0)]))),256))]))])):R("",!0)}}});export{Ve as default};
