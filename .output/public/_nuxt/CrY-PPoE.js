import{f as M,o as d,c as v,a as r,t as U,u as q,g as H,h as J,i as K,s as y,j as Q,r as W,k as X,l as Y,m as Z,n as o,q as ee,v as N,b as _,F as te,x as ne,y as oe,z as se,A as ae,B as ce}from"./BtqrO9Ir.js";import{_ as ie}from"./CuWq9ctS.js";import{_ as re}from"./DR3C1UCQ.js";import{_ as le}from"./B0ShGUTG.js";import{r as de,u as pe}from"./RkGtJdge.js";import{u as ue}from"./D3XDCgfQ.js";import"./DlAUqK2U.js";const me={class:"bg-lightGrey p-2 rounded"},_e={class:"text-sm"},ve=M({__name:"Pane",props:{content:{}},emits:["refresh"],setup($,{emit:p}){const C=$,A=p;return(S,n)=>(d(),v("div",me,[r("p",_e,U(C.content),1),r("button",{onClick:n[0]||(n[0]=g=>A("refresh")),class:"bg-white shadow px-2 py-1 rounded block mt-4"}," Refresh")]))}}),ge={class:"mt-24"},fe={key:0},ke={key:1},Ce={class:""},he={class:""},be=["onMouseenter"],we={class:"absolute w-full flex justify-between pointer-events-none z-10"},xe={class:"flex items-center pointer-events-auto"},ye=["onClick"],$e=["onClick"],Ae={class:"flex items-center bg-red pointer-events-auto"},Se=["onClick"],ze=M({__name:"[...slug]",async setup($){let p,C;const{$event:A,$listen:S}=oe(),{pb:n}=q(),g=H(),R=J(),w=K(),{moveDown:T,moveUp:V,setPage:B,savePage:x}=w,{page:u}=y(w);y(g);const{viewports:Be,componentId:z}=y(R);let h=Q().params.slug;h=h||"index";const m=W({storePending:!0,currentContainer:null}),{pending:De,data:c}=([p,C]=X(async()=>pe("pageContent",async()=>{const e=await n.collection("pages").getFirstListItem(`slug="${h}"`,{expand:"containers.block.blocks,containers.component,seo"});return structuredClone(e)})),p=await p,C(),p);m.storePending=!1,ue({title:c.value.expand.seo.title?`Eileen George — ${c.value.expand.seo.title}`:`Eileen George — ${c.value.title}`,meta:[{name:"description",content:c.value.expand.seo.description}]}),S("refresh",()=>{console.log("content saved"),m.storePending=!0,b()});const b=async()=>{await setTimeout(async()=>{await de("pageContent"),B(c.value)},400),m.storePending=!1},E=(e,t)=>{V(e,t),x()},G=(e,t)=>{T(e,t),x()},O=async(e,t)=>{const i=await n.collection("containers").getOne(e[t]),s=i.block,a=i.component;s&&await n.collection("blocks").delete(s),a&&await n.collection("components").delete(a),await n.collection("containers").delete(i.id),e.splice(t,1),x()},P=Y(()=>g.token?m.currentContainer:null),j=e=>{var i,s;const t=((i=e==null?void 0:e.expand.block)==null?void 0:i.id)||((s=e==null?void 0:e.expand.component)==null?void 0:s.id);return z.value===t},D=async e=>{const t=await n.collection("blocks").create({type:"default",isMaxContainer:!1,cssClasses:[[{paddingTop:"40px"},{marginTop:"40px"}],[],[],[],[]]}),s=(await n.collection("containers").create({block:t.id})).id,a=c.value.containers;a.splice(e,0,s),await n.collection("pages").update(c.value.id,{containers:a}),b()},I=async e=>{const t=await n.collection("components").create({type:"default"}),s=(await n.collection("containers").create({component:t.id})).id,a=c.value.containers;a.splice(e,0,s),await n.collection("pages").update(c.value.id,{containers:a}),b()};return Z(()=>{B(c.value)}),(e,t)=>{var F;const i=ve,s=ie,a=re,L=le;return d(),v("main",ge,[o(m).storePending?(d(),v("div",fe,"pending")):(d(),v("div",ke,[o(w).debugVisible?(d(),ee(i,{key:0,content:o(u),onRefresh:b},null,8,["content"])):N("",!0),r("div",Ce,[r("div",he,[_(s,{onAddBlock:t[0]||(t[0]=f=>D(0)),onAddComponent:t[1]||(t[1]=f=>I(0)),displayComponentOption:""}),(F=o(u))!=null&&F.expand?(d(!0),v(te,{key:0},ne(o(u).expand.containers,(f,l)=>(d(),v("div",{onMouseenter:k=>o(m).currentContainer=l,key:f.id,class:se([[{"hover:shadow-edit":o(g).token&&o(P)},{"cursor-cell":o(g).token},{"shadow-edit":j(f)}],"relative"])},[ae(r("div",we,[r("div",xe,[r("button",{onClick:k=>E(o(u).containers,l),class:"bg-gold"},[_(a,{name:"icon-triangle_up",class:"text-xl"})],8,ye),r("button",{onClick:k=>G(o(u).containers,l),class:"bg-gold"},[_(a,{name:"icon-triangle_down",class:"text-xl"})],8,$e)]),r("div",Ae,[r("button",{onClick:k=>O(o(u).containers,l)},[_(a,{name:"icon-cross",class:"text-xl"})],8,Se)])],512),[[ce,o(P)===l]]),_(L,{container:f,isFirst:l===0},null,8,["container","isFirst"]),_(s,{onAddBlock:k=>D(l+1),onAddComponent:k=>I(l+1),displayComponentOption:""},null,8,["onAddBlock","onAddComponent"])],42,be))),128)):N("",!0)])])]))])}}});export{ze as default};
